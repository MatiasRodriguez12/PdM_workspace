/*
 * API_delay.c
 *
 *  Created on: 7 sep. 2022
 *      Author: usuario
 */

#include <API_delay.h>

/*Defino las funciones*/
void delayInit( delay_t * delay, tick_t duration ){
	if (delay!=NULL && duration>0 && duration<MAX_DURATION){
		delay->duration=duration;
		delay->running=false;
	}
	else {
		while(1){
			BSP_LED_On(LED1);
		}
	}
}

bool_t delayRead( delay_t * delay ){
	tick_t currentTime;
	bool toggleLED=false;

	if (delay->running==false){
		delay->startTime=HAL_GetTick();
		delay->running=true;
	}
	else{
		currentTime=HAL_GetTick();
		if (currentTime - delay->startTime >= delay->duration){
			toggleLED=true;
			delay->running=false;
		}
	}
	return toggleLED;
}

void delayWrite( delay_t * delay, tick_t duration ){
	delay->duration=duration;
}
